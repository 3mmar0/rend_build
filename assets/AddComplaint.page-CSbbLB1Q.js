import{r as i,j as t,e as h,d as C}from"./index-CG21Kl6L.js";import{A as F}from"./BulkAddIcon-BvvCzB2l.js";import{S as A}from"./SyncIcon-CG554OSb.js";import{f as _,z as x,u as k,t as w,F as B}from"./index-CVKxZN6H.js";import{b as P,a as q}from"./axios-utils-DWLLXNPU.js";import{R as I}from"./RichTextInput-B15Nbosy.js";import{S as T}from"./SearchableSelectInputForm-B2qBDSGN.js";import{S as g}from"./SelectInputForm-nhbT-0nq.js";import{T as R}from"./TextInputForm-ML6m37PA.js";import{S as D}from"./SuccessPopup-CoLlaGCA.js";import{S as v}from"./SecondaryButton-C8PAsQMM.js";import{P as y}from"./PrimaryButton-CqSNXaEZ.js";import{C as L}from"./CancelPopup-DkpTHoXx.js";import"./index-DKOmws7K.js";import"./select-cvP0Sup0.js";import"./Combination-CF6sjIQ5.js";import"./index-CVxAI6rk.js";import"./SuccessIcon-kUOFEumJ.js";import"./dialog-BNTutzAA.js";import"./index-BuoIejD9.js";function M({maintenanceOrder:s}){const{setValue:e}=_(),[o,a]=i.useState([]),[p,l]=i.useState(null);return i.useEffect(()=>{(async()=>{try{const n=(await P({endpoint:h.customer.list})).data.data.data.map(d=>({name:d.full_name,value:String(d.id)}));a(n),l(null)}catch{l("Error fetching customers. Please try again later.")}})()},[]),i.useEffect(()=>{var r,u;o.length>0&&e("maintenance_center_id",(r=s==null?void 0:s.maintenance_center)!=null&&r.id?String((u=s==null?void 0:s.maintenance_center)==null?void 0:u.id):void 0)},[o]),t.jsx("div",{className:"my-6",children:t.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[t.jsx(T,{name:"customer_id",placeholder:"بحث عن اسم أو كود العميل",label:"اسم العميل",options:o,error:p}),t.jsx(R,{name:"title",placeholder:"بحث عن منتج، أو كتابة عنوان الشكوى",label:"موضوع الشكوى"}),t.jsx(g,{name:"receiving_method",placeholder:"خيارات",label:"طريقة استقبال الشكوى",options:[{name:"البريد الإلكتروني",value:"email"},{name:"الهاتف",value:"phone"},{name:"الفاكس",value:"fax"},{name:"البريد العادي",value:"mail"}],error:p,data:s}),t.jsx(g,{name:"department",placeholder:"خيارات",label:"القسم المختص",options:[{name:"القسم الأول",value:"1"},{name:"القسم الثاني",value:"2"},{name:"القسم الثالث",value:"3"},{name:"القسم الرابع",value:"4"}],error:p,data:s})]})})}const V=x.object({customer_id:x.string().min(1,"Customer field is required."),title:x.string().min(1,"Address is required"),receiving_method:x.string().min(1,"The complaint reception type field is required."),department:x.string().min(1,"Department is required"),description:x.string().min(1,"Description is required")});function z({maintenanceOrder:s,setShowCancelPopup:e,setShowSuccessPopup:o,showCancelPopup:a,showSuccessPopup:p,loading:l}){const r=C(),u=()=>{o(!1)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-row justify-end items-center mt-8",children:[s?t.jsx(v,{type:"button",className:"xl:px-[87px] xl:py-3 text-[#A21515] border border-red-error-50 xl:font-semibold bg-red-error-50",onClick:()=>e(!0),children:"إلغاء الشكوى"}):t.jsx(v,{type:"button",className:"xl:px-[87px] xl:py-3 border bordr-[#E8EFF6] xl:font-semibold",onClick:()=>e(!0),children:"الغاء"}),t.jsx("div",{children:s?t.jsx(y,{className:"xl:px-[91px] xl:py-3 xl:font-semibold ms-6",disabled:l,children:l?"جاري التحميل...":"حفظ التغييرات"}):t.jsx(y,{className:"xl:px-[91px] xl:py-3 xl:font-semibold ms-6",disabled:l,children:l?"جاري التحميل...":"تسجيل الشكوى"})})]}),t.jsx(L,{open:a,onClickButton1:()=>{e(!1)},onClickButton2:()=>{r("/customer-relations/complaints"),e(!1)},text1:s?"إلغاء تعديل بيانات تسجيل الشكوى":"إلغاء تسجيل الشكوى",text2:s?"أنت على وشك إلغاء عملية تعديل بيانات الشكوى دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟":"أنت على وشك إلغاء عملية إضافة الشكوى دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟",textButton1:"إكمال الشكوى",textButton2:"إلغاء الشكوى"}),t.jsx(D,{text1:s?"تم تعديل بيانات الشكوى بنحاح":"تم إضافة الشكوى بنحاح",text2:'تم تعديل بيانات الشكوى المطلوبة، يمكنك المتابعه مع مركز الشكاوى".',textButton1:"العودة لقائمة الشكاوى",textButton2:s?"تعديل بيانات اخرى":"إضافة شكوى اخرى",open:p,onAddAnother:u,onReturnToList:()=>{r("/customer-relations/complaints"),o(!1)}})]})}function G({maintenanceOrder:s}){const[e,o]=i.useState(null),[a,p]=i.useState(!1),[l,r]=i.useState(!1),[u,n]=i.useState(!1),d=i.useMemo(()=>({customer_id:(s==null?void 0:s.description)||"",title:s!=null&&s.cost?String(s==null?void 0:s.cost):void 0,receiving_method:(s==null?void 0:s.description)||"",department:(s==null?void 0:s.description)||"",description:(s==null?void 0:s.description)||""}),[s]),f=k({resolver:w(V),defaultValues:d}),S=async N=>{var j,b;p(!0),o(null);try{await q({endpoint:s?h.complaint.update+s.id:h.complaint.create,body:N}),r(!0)}catch(c){if((b=(j=c.response)==null?void 0:j.data)!=null&&b.errors)Object.entries(c.response.data.errors).forEach(([m,E])=>{f.setError(m,{type:"manual",message:E.join(", ")})});else{let m="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";c.response?m=c.response.data.msg||m:c.request&&(m="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),o(m)}}finally{p(!1)}};return t.jsx(t.Fragment,{children:t.jsx(B,{...f,children:t.jsxs("form",{onSubmit:f.handleSubmit(S),className:"mb-8",children:[e&&t.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"",children:e}),t.jsx("button",{onClick:()=>o(null),className:"text-red-700 hover:text-red-900",children:"×"})]})}),t.jsx(M,{maintenanceOrder:s}),t.jsxs("div",{children:[t.jsx("p",{className:"text-primery-blue-900 font-medium text-[18px] leading-[33.73px] tracking-normal text-start mb-4",children:"نص الشكوى"}),t.jsx(I,{form:f,data:s==null?void 0:s.description,name:"description",placeholder:"ادخل وصف المنتج"})]}),t.jsx(z,{maintenanceOrder:s,loading:a,setShowCancelPopup:n,setShowSuccessPopup:r,showCancelPopup:u,showSuccessPopup:l})]})})})}function ms(){return t.jsxs("div",{className:"w-full mt-6 p-4",children:[t.jsxs("div",{className:"flex flex-row items-center justify-between",children:[t.jsxs("h1",{className:"font-bold text-[#080614] text-[24px] tracking-normal flex flex-row items-center gap-2",children:[t.jsx(F,{}),"إضافة شكوى"]}),t.jsxs("div",{className:"px-4 py-3 bg-[#F5F4F5] border border-[#E1DEE0] rounded-lg flex flex-row items-center justify-between gap-2",children:[t.jsx("p",{className:"font-bold text-[#423E41] text-base tracking-normal",children:"رقم الشكوى:"}),t.jsx("p",{className:"font-medium text-[#9E939A] text-base tracking-normal me-[2px]",children:"#2324510"}),t.jsx(A,{})]})]}),t.jsx(G,{})]})}export{ms as default};
//# sourceMappingURL=AddComplaint.page-CSbbLB1Q.js.map
