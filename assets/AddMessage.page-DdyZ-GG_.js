import{d as C,j as e,r as a,e as y,f as E}from"./index-BYyXun5x.js";import{A as F}from"./BulkAddIcon-CkJjb4i1.js";import{f as A,z as u,u as B,t as k,F as _}from"./index-C2_QJ2lf.js";import{b as w,a as M}from"./axios-utils-AvuZ81CO.js";import{R as P}from"./RichTextInput-C1v2YfXj.js";import{S as T}from"./SuccessPopup-D1XZ3Spp.js";import{S as b}from"./SecondaryButton-DL_Bkgwn.js";import{P as g}from"./PrimaryButton-CZnRZgcz.js";import{C as q}from"./CancelPopup-DUQLiKLA.js";import{S as I}from"./SearchableSelectInputForm-v1_SI72T.js";import{S as R}from"./SelectInputForm-CG_Opxs4.js";import{T as L}from"./TextInputForm-DXNY8AYK.js";import"./index-CV4wEvKw.js";import"./SuccessIcon-BhPCSHz0.js";import"./dialog-CC_6CGm6.js";import"./Combination-cklTRtAe.js";import"./index-CLYNl1a9.js";import"./select-779NlImg.js";import"./index-Gk0NKYh3.js";function V({maintenanceOrder:s,setShowCancelPopup:t,setShowSuccessPopup:r,showCancelPopup:m,showSuccessPopup:n,loading:o}){const i=C(),c=()=>{r(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row justify-end items-center mt-8",children:[s?e.jsx(b,{type:"button",className:"xl:px-[87px] xl:py-3 text-[#A21515] border border-red-error-50 xl:font-semibold bg-red-error-50",onClick:()=>t(!0),children:"إلغاء الطلب"}):e.jsx(b,{type:"button",className:"xl:px-[87px] xl:py-3 border bordr-[#E8EFF6] xl:font-semibold",onClick:()=>t(!0),children:"الغاء"}),e.jsx("div",{children:s?e.jsx(g,{className:"xl:px-[91px] xl:py-3 xl:font-semibold ms-6",disabled:o,children:o?"جاري التحميل...":"حفظ التغييرات"}):e.jsx(g,{className:"xl:px-[125px] xl:py-3 xl:font-semibold ms-6",disabled:o,children:o?"جاري التحميل...":"إرسال"})})]}),e.jsx(q,{open:m,onClickButton1:()=>{t(!1)},onClickButton2:()=>{i("/customer-relations/customer-communication"),t(!1)},text1:s?"تم الغاء تعديل الرسالة":"تم الغاء الرسالة",text2:s?"أنت على وشك إلغاء عملية تعديل الرسالة دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟":"أنت على وشك إلغاء عملية ارسال الرسالة للعميل  دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟",textButton1:"إكمال الارسال",textButton2:"إلغاء الارسال"}),e.jsx(T,{text1:s?"تم تعديل  بنحاح":"تم ارسال الرسالة  للعميل  بنحاح",text2:s?"تم تعديل الرسالة بنجاح.":"تم ارسال الرسالة للعميل  بنجاح.",textButton1:"العودة لقائمة الرسائل",textButton2:s?"العودة لقائمة الرسائل":"ارسال رسالة اخرى",open:n,onAddAnother:c,onReturnToList:()=>{i("/customer-relations/customer-communication"),r(!1)}})]})}function z({id:s}){const{setValue:t}=A(),[r,m]=a.useState([]),[n,o]=a.useState(null);return a.useEffect(()=>{(async()=>{try{const f=(await w({endpoint:y.customer.list})).data.data.data.map(x=>({name:x.full_name,value:String(x.id)}));m(f),o(null)}catch{o("Error fetching customers. Please try again later.")}})()},[]),a.useEffect(()=>{r.length>0&&t("customer_id",s?String(s):void 0)},[r]),e.jsx("div",{className:"my-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(I,{name:"customer_id",placeholder:"بحث عن اسم أو كود العميل",label:"اسم العميل",options:r,error:n,data:s}),e.jsx(L,{name:"subject",placeholder:"بحث عن منتج، أو كتابة عنوان الرسالة",label:"موضوع الرسالة"}),e.jsx(R,{name:"send_method",placeholder:"طريقة ارسال الرسالة",label:"طريقة ارسال الرسالة",options:[{name:"رسالة SMS",value:"sms"},{name:"Email",value:"email"}]})]})})}const D=u.object({customer_id:u.string().min(1,"Customer field is required."),subject:u.string().min(1,"Address is required"),send_method:u.string().min(1,"The message reception type field is required."),message:u.string().min(1,"Description is required")});function G({id:s}){const[t,r]=a.useState(null),[m,n]=a.useState(!1),[o,i]=a.useState(!1),[c,f]=a.useState(!1),x=a.useMemo(()=>({customer_id:"",subject:"",send_method:"",message:""}),[]),p=B({resolver:k(D),defaultValues:x}),S=async N=>{var h,j;r(null),n(!0);try{await M({endpoint:y.cutomerContact.create,body:N,config:{headers:{"Content-Type":"multipart/form-data"}}}),i(!0)}catch(d){if((j=(h=d.response)==null?void 0:h.data)!=null&&j.errors)Object.entries(d.response.data.errors).forEach(([l,v])=>{p.setError(l,{type:"manual",message:v.join(", ")})});else{let l="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";d.response?l=d.response.data.msg||l:d.request&&(l="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),r(l)}}finally{n(!1)}};return e.jsx(e.Fragment,{children:e.jsx(_,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(S),className:"mb-8",children:[t&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"",children:t}),e.jsx("button",{onClick:()=>r(null),className:"text-red-700 hover:text-red-900",children:"×"})]})}),e.jsx(z,{id:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-primery-blue-900 font-medium text-[18px] leading-[33.73px] tracking-normal text-start mb-4",children:"نص الرسالة"}),e.jsx(P,{form:p,name:"message",placeholder:"ادخل وصف الرسالة"})]}),e.jsx(V,{loading:m,setShowCancelPopup:f,setShowSuccessPopup:i,showCancelPopup:c,showSuccessPopup:o})]})})})}function le(){const s=E(),{id:t}=s;return e.jsxs("div",{className:"w-full mt-6 p-4",children:[e.jsx("div",{className:"flex flex-row items-center justify-start",children:e.jsxs("h1",{className:"font-bold text-[#080614] text-[24px] tracking-normal flex flex-row items-center gap-2",children:[e.jsx(F,{}),"انشاء رسالة"]})}),e.jsx(G,{id:t})]})}export{le as default};
//# sourceMappingURL=AddMessage.page-DdyZ-GG_.js.map
