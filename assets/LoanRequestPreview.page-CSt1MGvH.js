import{r as n,d as S,j as e,e as h,t as g,f as _,g as F,L as R}from"./index-BYyXun5x.js";import{S as N}from"./SubtleButton-CpZm4xzO.js";import{U as P}from"./UnderlineHeading-ByjNC2ge.js";import{a as y,b as E}from"./axios-utils-AvuZ81CO.js";import{u as L,t as D,F as I}from"./index-C2_QJ2lf.js";import{P as T}from"./PrimaryButton-CZnRZgcz.js";import{T as u}from"./TextInputForm-DXNY8AYK.js";import{T as v}from"./TextAreaInputForm-BzEUWSiD.js";import{D as k}from"./DateInputForm-D1c84cxT.js";import{F as M}from"./FileInput-BEA6bpIv.js";import{R as C}from"./request-preview-schema-CbJ04yab.js";import{f as V}from"./format-D6Kkl3rb.js";import"./index-CV4wEvKw.js";import"./textarea-CQid9q9Y.js";import"./popover-BWwxYxvp.js";import"./chevron-right-CymCusjh.js";import"./chevron-left-DVnc3BG0.js";import"./Combination-cklTRtAe.js";import"./index-Gk0NKYh3.js";import"./index-CLYNl1a9.js";import"./select-779NlImg.js";import"./CalendarIcon-ChMYIy2j.js";import"./index-BUOh6qUH.js";import"./index-Cod7pasn.js";import"./SecondaryButton-DL_Bkgwn.js";import"./removeDuplicated-BgoSiW5F.js";function A({request:a}){const[m,r]=n.useState(null),[c,o]=n.useState(!1),p=S(),f=n.useMemo(()=>{var s;return{employeeName:((s=a==null?void 0:a.employee)==null?void 0:s.name)||"",loan_type:(a==null?void 0:a.loan_type)||"",amount:(a==null?void 0:a.amount)||"",reason:(a==null?void 0:a.reason)||"",date:new Date(a==null?void 0:a.data)||""}},[a]),t=L({resolver:D(C),defaultValues:f}),b=async s=>{var l,j;o(!0),r(null);try{await y({endpoint:h.loan.update+a.id,body:{...s,date:V(s.date,"yyyy-MM-dd"),status:"approved"},config:{headers:{"Content-Type":"multipart/form-data"}}}),g("تمت الموافقة بنجاح"),p("/human-resources/self-services?loans=true")}catch(d){if((j=(l=d.response)==null?void 0:l.data)!=null&&j.errors)Object.entries(d.response.data.errors).forEach(([i,w])=>{t.setError(i,{type:"manual",message:w.join(", ")})});else{let i="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";d.response?i=d.response.data.msg||i:d.request&&(i="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),r(i)}}finally{o(!1)}},x=async()=>{o(!0),r(null);try{await y({endpoint:h.loan.update+a.id,body:{status:"rejected",reject_reason:t.getValues("reject_reason"),reject_attachment:t.getValues("reject_attachment")},config:{headers:{"Content-Type":"multipart/form-data"}}}),g("تمت رفض الطلب بنجاح"),p("/human-resources/self-services?loans=true")}catch(s){let l="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";s.response?l=s.response.data.msg||l:s.request&&(l="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),r(l)}finally{o(!1)}};return e.jsx(e.Fragment,{children:e.jsx(I,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(b),className:"mt-6",children:[m&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"",children:m}),e.jsx("button",{onClick:()=>r(null),className:"text-red-700 hover:text-red-900",children:"×"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6",children:[e.jsx(u,{disabled:!0,name:"employeeName",label:"اسم الموظف",placeholder:""}),e.jsx(u,{disabled:!0,name:"loan_type",label:"نوع القرض",placeholder:""}),e.jsx(u,{disabled:!0,name:"amount",label:"المبلغ",placeholder:""}),e.jsx(u,{disabled:!0,name:"reason",label:"السبب",placeholder:""}),e.jsx(k,{disabledDate:!0,name:"date",label:"التاريخ",placeholder:"2025/05/10"})]}),e.jsx(v,{disabled:!0,className:"flex flex-col min-h-[130px] mb-1",name:"note",label:"ملاحظات اضافية",placeholder:"اكتب ملاحظات اضافية"}),e.jsx(v,{disabled:!0,className:"flex flex-col min-h-[130px] mb-1",name:"reject_reason",label:"ملاحظات منشئ الطلب",placeholder:"اكتب ملاحظات اضافية"}),e.jsx(M,{name:"reject_attachment",label:"رفع ملف",multiple:!1,maxSize:10*1024*1024}),e.jsxs("div",{className:"flex flex-row justify-end gap-4 mt-12 mb-14",children:[e.jsx(N,{type:"button",className:"text-base bg-red-error-50 !px-16 text-[#A21515] leading-5 hover:bg-red-error-50 hover:opacity-80 tracking-normal py-[10px] font-medium",onClick:x,children:"رفض"}),e.jsx(T,{type:"submit",className:"text-base leading-5 !px-28 tracking-normal font-medium py-[10px]",children:c?"جاري الموافقة...":"موافقة"})]})]})})})}function ce(){const[a,m]=n.useState(!0),[r,c]=n.useState(null),[o,p]=n.useState(null),f=_(),{id:t}=f;return n.useEffect(()=>{t?(async()=>{try{const x=await E({endpoint:h.loan.show+t});p(x.data.data)}catch{c("Failed to load request details")}finally{m(!1)}})():(c("Invalid request ID"),m(!1))},[t]),a?e.jsx(F,{}):r?e.jsx("div",{className:"mt-6 mb-[102px] text-center py-20",children:e.jsx("h2",{className:"text-xl text-red-500",children:r})}):o?e.jsxs("div",{className:"w-full mt-6",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-6",children:[e.jsx(P,{text:"معاينة الطلب"}),e.jsx(R,{to:"/human-resources/self-services",children:e.jsx(N,{className:"bg-white-blue-50 text-base font-medium leading-[125%] text-white-blue-900 border border-white-blue-500 shadow-[0px_1px_2px_0px_#1018280D]",children:"عودة لقائمة الطلبات"})})]}),e.jsx(A,{request:o})]}):e.jsx("div",{className:"mt-6 mb-[102px] text-center py-20",children:e.jsx("h2",{className:"text-xl",children:"Request not found"})})}export{ce as default};
//# sourceMappingURL=LoanRequestPreview.page-CSt1MGvH.js.map
