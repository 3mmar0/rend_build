{"version":3,"file":"LoanRequestPreview.page-CSt1MGvH.js","sources":["../../src/features/hrSelfServices/forms/LoanRequestPreviewForm.tsx","../../src/features/hrSelfServices/pages/LoanRequestPreview.page.tsx"],"sourcesContent":["import { Form } from '@/components/ui/form';\r\nimport { useForm } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { apiPost } from '@/lib/axios/axios-utils';\r\nimport { endpoints } from '@/lib/axios/axios-global';\r\nimport { useMemo, useState } from 'react';\r\nimport { PrimaryButton } from '@/components/buttons/PrimaryButton';\r\nimport { toast } from 'sonner';\r\nimport TextInputForm from '@/components/forms/TextInputForm';\r\nimport TextAreaInputForm from '@/components/forms/TextAreaInputForm';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { DateInputForm } from '@/components/forms/DateInputForm';\r\nimport FileInput from './FileInput';\r\nimport { RequestPreviewFormValues, RequestPreviewSchema } from './schemas/request-preview-schema';\r\nimport { formatDate } from 'date-fns';\r\nimport { SubtleButton } from '@/components/buttons/SubtleButton';\r\nimport { Loan } from '@/types/loan.types';\r\n\r\ninterface Props {\r\n    request: Loan;\r\n}\r\n\r\nexport default function LoanRequestPreviewForm({ request }: Props) {\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const navigate = useNavigate();\r\n\r\n    const defaultValues = useMemo(\r\n        () => ({\r\n            employeeName: request?.employee?.name || '',\r\n            loan_type: request?.loan_type || '',\r\n            amount: request?.amount || '',\r\n            reason: request?.reason || '',\r\n            date: new Date(request?.data) || '',\r\n        }),\r\n        [request],\r\n    );\r\n\r\n    const form = useForm<RequestPreviewFormValues>({\r\n        resolver: zodResolver(RequestPreviewSchema),\r\n        defaultValues,\r\n    });\r\n\r\n    const onSubmit = async (data: RequestPreviewFormValues) => {\r\n        setLoading(true);\r\n        setError(null); // Clear previous errors\r\n\r\n        try {\r\n            await apiPost({\r\n                endpoint: endpoints.loan.update + request.id,\r\n                body: { ...data, date: formatDate(data.date, 'yyyy-MM-dd'), status: 'approved' },\r\n                config: { headers: { 'Content-Type': 'multipart/form-data' } },\r\n            });\r\n\r\n            toast('تمت الموافقة بنجاح');\r\n            navigate('/human-resources/self-services?loans=true');\r\n        } catch (error: any) {\r\n            if (error.response?.data?.errors) {\r\n                // Handle field-specific errors\r\n                Object.entries(error.response.data.errors).forEach(([field, messages]) => {\r\n                    form.setError(field as any, {\r\n                        type: 'manual',\r\n                        message: (messages as string[]).join(', '),\r\n                    });\r\n                });\r\n            } else {\r\n                // Handle generic error\r\n                let errorMessage = 'حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.';\r\n                if (error.response) {\r\n                    errorMessage = error.response.data.msg || errorMessage;\r\n                } else if (error.request) {\r\n                    errorMessage = 'تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت.';\r\n                }\r\n                setError(errorMessage);\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const rejectRequest = async () => {\r\n        setLoading(true);\r\n        setError(null); // Clear previous errors\r\n\r\n        try {\r\n            await apiPost({\r\n                endpoint: endpoints.loan.update + request.id,\r\n                body: {\r\n                    status: 'rejected',\r\n                    reject_reason: form.getValues('reject_reason'),\r\n                    reject_attachment: form.getValues('reject_attachment'),\r\n                },\r\n                config: { headers: { 'Content-Type': 'multipart/form-data' } },\r\n            });\r\n\r\n            toast('تمت رفض الطلب بنجاح');\r\n            navigate('/human-resources/self-services?loans=true');\r\n        } catch (error: any) {\r\n            // Handle generic error\r\n            let errorMessage = 'حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.';\r\n            if (error.response) {\r\n                errorMessage = error.response.data.msg || errorMessage;\r\n            } else if (error.request) {\r\n                errorMessage = 'تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت.';\r\n            }\r\n            setError(errorMessage);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Form {...form}>\r\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"mt-6\">\r\n                    {error && (\r\n                        <div className=\"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className=\"\">{error}</span>\r\n                                <button onClick={() => setError(null)} className=\"text-red-700 hover:text-red-900\">\r\n                                    ×\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-6\">\r\n                        <TextInputForm disabled name=\"employeeName\" label=\"اسم الموظف\" placeholder=\"\" />\r\n                        <TextInputForm disabled name=\"loan_type\" label=\"نوع القرض\" placeholder=\"\" />\r\n                        <TextInputForm disabled name=\"amount\" label=\"المبلغ\" placeholder=\"\" />\r\n                        <TextInputForm disabled name=\"reason\" label=\"السبب\" placeholder=\"\" />\r\n                        <DateInputForm disabledDate name=\"date\" label=\"التاريخ\" placeholder=\"2025/05/10\" />\r\n                    </div>\r\n                    <TextAreaInputForm\r\n                        disabled\r\n                        className=\"flex flex-col min-h-[130px] mb-1\"\r\n                        name=\"note\"\r\n                        label=\"ملاحظات اضافية\"\r\n                        placeholder=\"اكتب ملاحظات اضافية\"\r\n                    />\r\n                    {/* <FileInput name=\"attachment\" label=\"رفع ملف\" multiple={false} maxSize={10 * 1024 * 1024} /> */}\r\n\r\n                    <TextAreaInputForm\r\n                        disabled\r\n                        className=\"flex flex-col min-h-[130px] mb-1\"\r\n                        name=\"reject_reason\"\r\n                        label=\"ملاحظات منشئ الطلب\"\r\n                        placeholder=\"اكتب ملاحظات اضافية\"\r\n                    />\r\n                    <FileInput name=\"reject_attachment\" label=\"رفع ملف\" multiple={false} maxSize={10 * 1024 * 1024} />\r\n\r\n                    <div className=\"flex flex-row justify-end gap-4 mt-12 mb-14\">\r\n                        <SubtleButton\r\n                            type=\"button\"\r\n                            className=\"text-base bg-red-error-50 !px-16 text-[#A21515] leading-5 hover:bg-red-error-50 hover:opacity-80 tracking-normal py-[10px] font-medium\"\r\n                            onClick={rejectRequest}\r\n                        >\r\n                            رفض\r\n                        </SubtleButton>\r\n                        <PrimaryButton\r\n                            type=\"submit\"\r\n                            className=\"text-base leading-5 !px-28 tracking-normal font-medium py-[10px]\"\r\n                        >\r\n                            {loading ? 'جاري الموافقة...' : 'موافقة'}\r\n                        </PrimaryButton>\r\n                    </div>\r\n                </form>\r\n            </Form>\r\n        </>\r\n    );\r\n}\r\n","import { SubtleButton } from '@/components/buttons/SubtleButton';\r\nimport UnderlineHeading from '@/components/heading/UnderlineHeading';\r\nimport { Link, useParams } from 'react-router-dom';\r\nimport { useEffect, useState } from 'react';\r\nimport { apiGet } from '@/lib/axios/axios-utils';\r\nimport { endpoints } from '@/lib/axios/axios-global';\r\nimport { LoadingSpinner } from '@/components/Loading/LoadingSpinner';\r\nimport { Loan } from '@/types/loan.types';\r\nimport LoanRequestPreviewForm from '../forms/LoanRequestPreviewForm';\r\n\r\nexport default function LoanRequestPreviewPage() {\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [request, setRequest] = useState<Loan | null>(null);\r\n\r\n    const params = useParams();\r\n    const { id } = params;\r\n\r\n    useEffect(() => {\r\n        const fetchRequest = async () => {\r\n            try {\r\n                const response = await apiGet({\r\n                    endpoint: endpoints.loan.show + id,\r\n                });\r\n                setRequest(response.data.data);\r\n            } catch (error) {\r\n                setError('Failed to load request details');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        if (id) {\r\n            fetchRequest();\r\n        } else {\r\n            setError('Invalid request ID');\r\n            setLoading(false);\r\n        }\r\n    }, [id]);\r\n\r\n    if (loading) {\r\n        return <LoadingSpinner />;\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"mt-6 mb-[102px] text-center py-20\">\r\n                <h2 className=\"text-xl text-red-500\">{error}</h2>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!request) {\r\n        return (\r\n            <div className=\"mt-6 mb-[102px] text-center py-20\">\r\n                <h2 className=\"text-xl\">Request not found</h2>\r\n            </div>\r\n        );\r\n    }\r\n    \r\n    return (\r\n        <div className=\"w-full mt-6\">\r\n            <div className=\"flex flex-row justify-between mb-6\">\r\n                <UnderlineHeading text=\"معاينة الطلب\" />\r\n                <Link to=\"/human-resources/self-services\">\r\n                    <SubtleButton className=\"bg-white-blue-50 text-base font-medium leading-[125%] text-white-blue-900 border border-white-blue-500 shadow-[0px_1px_2px_0px_#1018280D]\">\r\n                        عودة لقائمة الطلبات\r\n                    </SubtleButton>\r\n                </Link>\r\n            </div>\r\n            <LoanRequestPreviewForm request={request} />\r\n        </div>\r\n    );\r\n}\r\n"],"names":["LoanRequestPreviewForm","request","error","setError","useState","loading","setLoading","navigate","useNavigate","defaultValues","useMemo","_a","form","useForm","zodResolver","RequestPreviewSchema","onSubmit","data","apiPost","endpoints","formatDate","toast","field","messages","errorMessage","rejectRequest","jsx","Fragment","Form","jsxs","TextInputForm","DateInputForm","TextAreaInputForm","FileInput","SubtleButton","PrimaryButton","LoanRequestPreviewPage","setRequest","params","useParams","id","useEffect","response","apiGet","LoadingSpinner","UnderlineHeading","Link"],"mappings":"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"}