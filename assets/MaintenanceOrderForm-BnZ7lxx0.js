import{r as o,j as e,e as b,d as P,u as B}from"./index-BYyXun5x.js";import{z as i,f as D,u as k,t as A,F as T}from"./index-C2_QJ2lf.js";import{P as S}from"./PrimaryButton-CZnRZgcz.js";import{b as I,a as R}from"./axios-utils-AvuZ81CO.js";import{S as C}from"./SecondaryButton-DL_Bkgwn.js";import{D as M}from"./DayPickerInputForm-BVMb7yWz.js";import{S as L}from"./SelectInputForm-CG_Opxs4.js";import{T as g}from"./TextInputForm-DXNY8AYK.js";import{C as V}from"./CancelPopup-DUQLiKLA.js";import{R as z}from"./RichTextInput-C1v2YfXj.js";import{S as G}from"./SuccessPopup-D1XZ3Spp.js";import{f as q}from"./format-D6Kkl3rb.js";const H=i.object({maintenance_date:i.date({required_error:"Maintenance last date is required"}),next_maintenance_date:i.date({required_error:"Next maintenance date last date is required"}),maintenance_center_id:i.string({required_error:"Maintenance center is required"}).min(1,"Maintenance center is required"),next_maintenance_mileage:i.string({required_error:"Next maintenance mileage damage is required"}).min(1,"Next maintenance mileage damage is required"),maintenance_type:i.string().min(1,"Maintenance type is required"),cost:i.string({required_error:"Cost maintenance mileage damage is required"}).min(1,"Cost maintenance mileage damage is required"),description:i.string().min(1,"Description is required")});function J({maintenanceOrder:t}){const{setValue:f}=D(),[l,a]=o.useState([]),[r,_]=o.useState(null);return o.useEffect(()=>{(async()=>{try{const u=(await I({endpoint:b.maintenanCenter.select})).data.data.map(c=>({name:c.name,value:String(c.id)}));a(u),_(null)}catch{_("Error fetching maintenanceCenters. Please try again later.")}})()},[]),o.useEffect(()=>{var s,p;l.length>0&&f("maintenance_center_id",(s=t==null?void 0:t.maintenance_center)!=null&&s.id?String((p=t==null?void 0:t.maintenance_center)==null?void 0:p.id):void 0)},[l]),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(M,{name:"maintenance_date",label:"تاريخ اخر صيانة",placeholder:"ادخل تاريخ اخر صيانة",disabled:s=>s>=new Date}),e.jsx(M,{name:"next_maintenance_date",label:"تاريخ الصيانة القادمة",placeholder:"ادخل تاريخ الصيانة القادمة"}),e.jsx(L,{name:"maintenance_center_id",placeholder:"أماكن الصيانة المعتمدة",label:"مكان الصيانة",options:l,error:r,data:t}),e.jsx(g,{name:"maintenance_type",label:"نوع العطل",placeholder:"ادخل نوع الصيانة "}),e.jsx(g,{name:"cost",type:"number",label:"التكلفة",placeholder:"ادخل التكلفة"}),e.jsx(g,{name:"next_maintenance_mileage",type:"number",label:"عدد كيلومترات الصيانة القادمة",placeholder:"ادخل عدد كيلومترات الصيانة القادمة"})]})})}function ot({maintenanceOrder:t}){const[f,l]=o.useState(null),[a,r]=o.useState(!1),[_,s]=o.useState(!1),[p,u]=o.useState(!1),c=P(),m=B(n=>n.car.selectedCar),N=o.useMemo(()=>({vehicle_id:t!=null&&t.id?String(t==null?void 0:t.id):void 0,maintenance_date:t!=null&&t.maintenance_date?new Date(t==null?void 0:t.maintenance_date):void 0,next_maintenance_date:t!=null&&t.next_maintenance_date?new Date(t==null?void 0:t.next_maintenance_date):void 0,next_maintenance_mileage:t!=null&&t.next_maintenance_mileage?String(t==null?void 0:t.next_maintenance_mileage):void 0,maintenance_type:(t==null?void 0:t.maintenance_type)||"",cost:t!=null&&t.cost?String(t==null?void 0:t.cost):void 0,description:(t==null?void 0:t.description)||"",maintenance_center_id:t!=null&&t.maintenance_center_id?String(t==null?void 0:t.maintenance_center_id):void 0}),[t]),h=k({resolver:A(H),defaultValues:N}),v=()=>{s(!1)},E=async n=>{var y,j;if(l(null),m||t){r(!0);const w={...n,next_maintenance_date:q(n.next_maintenance_date,"yyyy-MM-dd"),maintenance_date:q(n.maintenance_date,"yyyy-MM-dd"),vehicle_id:t?t.vehicle.id:m==null?void 0:m.id,status:"completed"};try{await R({endpoint:t?b.maintenance.update+t.id:b.maintenance.create,body:w,config:{headers:{"Content-Type":"multipart/form-data"}}}),s(!0)}catch(d){if((j=(y=d.response)==null?void 0:y.data)!=null&&j.errors)Object.entries(d.response.data.errors).forEach(([x,F])=>{h.setError(x,{type:"manual",message:F.join(", ")})});else{let x="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";d.response?x=d.response.data.msg||x:d.request&&(x="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),l(x)}}finally{r(!1)}}else l("قم بإختيار سيارة للمتابعة")};return e.jsxs(e.Fragment,{children:[e.jsx(T,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(E),className:"mb-8",children:[f&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"",children:f}),e.jsx("button",{onClick:()=>l(null),className:"text-red-700 hover:text-red-900",children:"×"})]})}),e.jsx(J,{maintenanceOrder:t}),e.jsx(z,{form:h,data:t==null?void 0:t.description,name:"description",placeholder:"ادخل ملاحظات عن العميل"}),e.jsxs("div",{className:"flex flex-row justify-end items-center mt-8",children:[t?e.jsx(C,{type:"button",className:"xl:px-[101px] xl:py-[18px] text-[#A21515] border border-red-error-50 xl:font-bold bg-red-error-50",onClick:()=>u(!0),children:"إلغاء الطلب"}):e.jsx(C,{type:"button",className:"xl:px-[125px] xl:py-[18px] border bordr-[#E8EFF6] xl:font-bold",onClick:()=>u(!0),children:"الغاء"}),e.jsx("div",{children:t?e.jsx(S,{className:"xl:px-[124px] xl:py-[18px] xl:font-bold ms-6",disabled:a,children:a?"جاري التحميل...":"حفظ التغييرات"}):e.jsx(S,{className:"xl:px-[154px] xl:py-[18px] xl:font-bold ms-6",disabled:a,children:a?"جاري التحميل...":"اضافة"})})]})]})}),e.jsx(V,{open:p,onClickButton1:()=>{u(!1)},onClickButton2:()=>{c("/maintenance/list"),u(!1)},text1:t?"إلغاء تعديل بيانات طلب الصيانة":"إلغاء طلب الصيانة",text2:t?"أنت على وشك إلغاء عملية تعديل بيانات طلب صيانة دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟":"أنت على وشك إلغاء عملية إضافة طلب صيانة دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟",textButton1:"إكمال الطلب",textButton2:"إلغاء الطلب"}),e.jsx(G,{text1:t?"تم تعديل طلب الصيانة بنحاح":"تم إضافة طلب الصيانة بنحاح",text2:t?"تم تعديل بيانات طلب الصيانة المطلوبة، يمكنك المتابعه مع مركز الصيانة.":"تم تسجيل بيانات طلب الصيانة المطلوبة، يمكنك المتابعه مع مركز الصيانة.",textButton1:"العودة لقائمة الصيانة",textButton2:t?"تعديل بيانات اخرى":"إضافة طلب أخر",open:_,onAddAnother:v,onReturnToList:()=>{c("/maintenance/list"),s(!1)}})]})}export{ot as M};
//# sourceMappingURL=MaintenanceOrderForm-BnZ7lxx0.js.map
