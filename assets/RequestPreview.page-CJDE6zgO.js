import{r as i,d as w,j as e,e as f,t as j,f as F,g as _,L as R}from"./index-BYyXun5x.js";import{S as N}from"./SubtleButton-CpZm4xzO.js";import{U as P}from"./UnderlineHeading-ByjNC2ge.js";import{u as I,t as T,F as E}from"./index-C2_QJ2lf.js";import{a as g,b as k}from"./axios-utils-AvuZ81CO.js";import{P as D}from"./PrimaryButton-CZnRZgcz.js";import{T as y}from"./TextInputForm-DXNY8AYK.js";import{T as v}from"./TextAreaInputForm-BzEUWSiD.js";import{S as M}from"./SelectInputForm-CG_Opxs4.js";import{T as q}from"./TimeInputForm-zvEH8xvK.js";import{D as L}from"./DateInputForm-D1c84cxT.js";import{F as C}from"./FileInput-BEA6bpIv.js";import{R as V}from"./request-preview-schema-CbJ04yab.js";import{f as A}from"./format-D6Kkl3rb.js";import"./index-CV4wEvKw.js";import"./textarea-CQid9q9Y.js";import"./select-779NlImg.js";import"./Combination-cklTRtAe.js";import"./index-Gk0NKYh3.js";import"./popover-BWwxYxvp.js";import"./chevron-right-CymCusjh.js";import"./chevron-left-DVnc3BG0.js";import"./index-CLYNl1a9.js";import"./CalendarIcon-ChMYIy2j.js";import"./index-BUOh6qUH.js";import"./index-Cod7pasn.js";import"./SecondaryButton-DL_Bkgwn.js";import"./removeDuplicated-BgoSiW5F.js";function B({request:t}){const[m,a]=i.useState(null),[d,s]=i.useState(!1),p=w(),x=i.useMemo(()=>({employeeName:t.employee.name||"",service_type:t.service_type||"",purpose:t.purpose||"",time:t.time||"",date:new Date(t.date)||"",note:t.note||"",attachment:t.attachment||""}),[t]),r=I({resolver:T(V),defaultValues:x}),h=async l=>{var o,b;s(!0),a(null);try{await g({endpoint:f.extraServices.update+t.id,body:{...l,date:A(l.date,"yyyy-MM-dd"),status:"approved"},config:{headers:{"Content-Type":"multipart/form-data"}}}),j("تمت الموافقة بنجاح"),p("/human-resources/self-services")}catch(c){if((b=(o=c.response)==null?void 0:o.data)!=null&&b.errors)Object.entries(c.response.data.errors).forEach(([n,S])=>{r.setError(n,{type:"manual",message:S.join(", ")})});else{let n="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";c.response?n=c.response.data.msg||n:c.request&&(n="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),a(n)}}finally{s(!1)}},u=async()=>{s(!0),a(null);try{await g({endpoint:f.extraServices.update+t.id,body:{status:"rejected",reject_reason:r.getValues("reject_reason"),reject_attachment:r.getValues("reject_attachment")},config:{headers:{"Content-Type":"multipart/form-data"}}}),j("تمت رفض الطلب بنجاح"),p("/human-resources/self-services")}catch(l){let o="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";l.response?o=l.response.data.msg||o:l.request&&(o="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),a(o)}finally{s(!1)}};return e.jsx(e.Fragment,{children:e.jsx(E,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(h),className:"mt-6",children:[m&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"",children:m}),e.jsx("button",{onClick:()=>a(null),className:"text-red-700 hover:text-red-900",children:"×"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6",children:[e.jsx(y,{disabled:!0,name:"employeeName",label:"اسم الموظف",placeholder:""}),e.jsx(M,{name:"service_type",label:"نوع الخدمة",placeholder:"طلب تقرير",disabled:!0,options:[{name:"شهادة خبرة",value:"experience certificate"},{name:"طلب تدريب",value:"trainee"},{name:"حجز تذكرة طلب اجتماع",value:"meeting ticket"},{name:"استقالة",value:"resignation"},{name:"طلب تقرير",value:"report request"}]}),e.jsx(y,{disabled:!0,name:"purpose",label:"الغرض",placeholder:"متابعة الاداء"}),e.jsx(q,{disabled:!0,name:"time",label:"الوقت",placeholder:"9:00 PM"}),e.jsx(L,{disabledDate:!0,name:"date",label:"التاريخ",placeholder:"2025/05/10"})]}),e.jsx(v,{disabled:!0,className:"flex flex-col min-h-[130px] mb-1",name:"note",label:"ملاحظات اضافية",placeholder:"اكتب ملاحظات اضافية"}),e.jsx(v,{disabled:!0,className:"flex flex-col min-h-[130px] mb-1",name:"reject_reason",label:"ملاحظات منشئ الطلب",placeholder:"اكتب ملاحظات اضافية"}),e.jsx(C,{name:"reject_attachment",label:"رفع ملف",multiple:!1,maxSize:10*1024*1024}),e.jsxs("div",{className:"flex flex-row justify-end gap-4 mt-12 mb-14",children:[e.jsx(N,{type:"button",className:"text-base bg-red-error-50 !px-16 text-[#A21515] leading-5 hover:bg-red-error-50 hover:opacity-80 tracking-normal py-[10px] font-medium",onClick:u,children:"رفض"}),e.jsx(D,{type:"submit",className:"text-base leading-5 !px-28 tracking-normal font-medium py-[10px]",children:d?"جاري الموافقة...":"موافقة"})]})]})})})}function fe(){const[t,m]=i.useState(!0),[a,d]=i.useState(null),[s,p]=i.useState(null),x=F(),{id:r}=x;return i.useEffect(()=>{r?(async()=>{try{const u=await k({endpoint:f.extraServices.show+r});p(u.data.data)}catch{d("Failed to load request details")}finally{m(!1)}})():(d("Invalid request ID"),m(!1))},[r]),t?e.jsx(_,{}):a?e.jsx("div",{className:"mt-6 mb-[102px] text-center py-20",children:e.jsx("h2",{className:"text-xl text-red-500",children:a})}):s?e.jsxs("div",{className:"w-full mt-6",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-6",children:[e.jsx(P,{text:"معاينة الطلب"}),e.jsx(R,{to:"/human-resources/self-services",children:e.jsx(N,{className:"bg-white-blue-50 text-base font-medium leading-[125%] text-white-blue-900 border border-white-blue-500 shadow-[0px_1px_2px_0px_#1018280D]",children:"عودة لقائمة الطلبات"})})]}),e.jsx(B,{request:s})]}):e.jsx("div",{className:"mt-6 mb-[102px] text-center py-20",children:e.jsx("h2",{className:"text-xl",children:"Request not found"})})}export{fe as default};
//# sourceMappingURL=RequestPreview.page-CJDE6zgO.js.map
