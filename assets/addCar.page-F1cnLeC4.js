import{r as m,d as S,j as e,e as C,L as O}from"./index-BYyXun5x.js";import{S as b}from"./SubtleButton-CpZm4xzO.js";import{U as M}from"./UnderlineHeading-ByjNC2ge.js";import{z as r,u as k,t as I,F}from"./index-C2_QJ2lf.js";import{V as A,a as B,T as N,C as P,I as L,E as T,D as $}from"./CarColor-DUaSqpZ9.js";import{P as D}from"./PrimaryButton-CZnRZgcz.js";import{a as z}from"./axios-utils-AvuZ81CO.js";import{C as V}from"./CancelPopup-DUQLiKLA.js";import{S as U}from"./SuccessPopup-D1XZ3Spp.js";import{f as h}from"./format-D6Kkl3rb.js";import"./index-CV4wEvKw.js";import"./select-779NlImg.js";import"./Combination-cklTRtAe.js";import"./index-Gk0NKYh3.js";import"./popover-BWwxYxvp.js";import"./chevron-right-CymCusjh.js";import"./chevron-left-DVnc3BG0.js";import"./index-CLYNl1a9.js";import"./CalendarIcon-ChMYIy2j.js";import"./radio-group-DV1HhCjd.js";import"./index-DEdjAgo6.js";import"./configs.data-DRMm0Ppl.js";import"./TextInputForm-DXNY8AYK.js";import"./ImgInputForm-DDkW58ya.js";import"./index-BUOh6qUH.js";import"./index-Cod7pasn.js";import"./SecondaryButton-DL_Bkgwn.js";import"./removeDuplicated-BgoSiW5F.js";import"./dialog-CC_6CGm6.js";import"./SuccessIcon-BhPCSHz0.js";const o=10*1024*1024,u=["image/jpeg","image/png","image/jpg","image/gif","image/svg+xml"],R=r.object({arabicOtp:r.string().length(3,"Must be exactly 3 Arabic characters/digits").regex(/^[\u0600-\u06FF0-9]{3}$/,"Invalid Arabic characters or numbers"),numericOtp:r.string().length(4,"Must be exactly 4 digits").regex(/^\d{4}$/,"Must be numeric digits only"),englishOtp:r.string().length(3,"Must be exactly 3 English letters").regex(/^[A-Z]{3}$/i,"English letters only").transform(t=>t.toUpperCase()),make_year:r.number({required_error:"Year of manufacture is required"}),vehicle_brand_id:r.number({required_error:"Brand is required"}),vehicle_model_id:r.number({required_error:"Model is required"}),car_type:r.string().min(2,"Car type is required"),transmission_type:r.enum(["auto","manual"]),tank:r.string().min(1,"Tank capacity is required"),vin:r.string().min(2,"Chassis number is required"),horse_power:r.string().min(1,"Engine power is required"),mileage:r.string().min(1,"Number of kilometers is required"),insurance_type:r.string().min(1,"Insurance type is required"),insurance_expiry_date:r.date({required_error:"Insurance end date is required"}).min(new Date,"Insurance must be valid"),license_expiry_date:r.date({required_error:"License expiry date is required"}).min(new Date,"License expiry date must be valid"),color:r.string().min(1,"Color is required"),next_maintainance_mile:r.string().min(0,"Next maintenance mileage must be a positive integer"),status:r.enum(["available","not available"]),images:r.array(r.instanceof(File)).min(1,"At least one image is required").max(4,"Maximum 4 files allowed").refine(t=>t.every(s=>s.size<=o),`Each Image must be less than ${o}MB`).refine(t=>t.every(s=>u.includes(s.type)),"Only .jpeg, .png, .jpg, .gif, and .svg formats are allowed"),image:r.instanceof(File,{message:"Image is required"}).refine(t=>t.size<=o,`Image must be less than ${o}MB`).refine(t=>u.includes(t.type),"Only .jpeg, .png, .jpg, .gif, and .svg formats are allowed"),license:r.array(r.instanceof(File)).min(1,"At least one image is required").max(2,"Maximum 2 images allowed").refine(t=>t.every(s=>s.size<=o),`Each file must be less than ${o}MB`).refine(t=>t.every(s=>u.includes(s.type)),"Only .jpeg, .png, .jpg, .gif, and .svg formats are allowed")});function Y(){const[t,s]=m.useState(null),[p,x]=m.useState(!1),[_,d]=m.useState(!1),[j,c]=m.useState(!1),g=S(),n=k({resolver:I(R),defaultValues:{arabicOtp:"",numericOtp:"",englishOtp:"",make_year:void 0,vehicle_model_id:void 0,vehicle_brand_id:void 0,car_type:"",vin:"",color:"",tank:"",horse_power:"",mileage:"",next_maintainance_mile:void 0,transmission_type:"auto",insurance_type:"",insurance_expiry_date:void 0,license_expiry_date:void 0,images:[],license:[]}}),v=()=>{d(!1)},q=async a=>{var f,y;x(!0),s(null);const w={...a,insurance_expiry_date:h(a.insurance_expiry_date,"yyyy-MM-dd"),license_expiry_date:h(a.license_expiry_date,"yyyy-MM-dd"),plate_number:`${a.arabicOtp}-${a.numericOtp}-${a.englishOtp}`,branch_id:1};try{await z({endpoint:C.cars.create,body:w,config:{headers:{"Content-Type":"multipart/form-data"}}}),d(!0)}catch(l){if((y=(f=l.response)==null?void 0:f.data)!=null&&y.errors)Object.entries(l.response.data.errors).forEach(([i,E])=>{i==="plate_number"&&(n.setError("arabicOtp",{type:"manual",message:"The plate number has already been taken"}),n.setError("englishOtp",{type:"manual",message:"The plate number has already been taken"}),n.setError("numericOtp",{type:"manual",message:"The plate number has already been taken"})),n.setError(i,{type:"manual",message:E.join(", ")})});else{let i="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";l.response?i=l.response.data.msg||i:l.request&&(i="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),s(i)}}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(F,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(q),children:[e.jsx(A,{}),e.jsx(B,{}),e.jsx(N,{}),e.jsx(P,{}),e.jsx(L,{}),e.jsx(T,{}),e.jsx($,{}),t&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:t}),e.jsx("button",{onClick:()=>s(null),className:"text-red-700 hover:text-red-900",children:"×"})]})}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx(b,{onClick:()=>c(!0),type:"button",className:"xl:px-[61.5px] xl:py-4 xl:font-bold",children:"الغاء"}),e.jsx("div",{children:e.jsx(D,{className:"xl:px-[154px] xl:py-[18px] xl:font-bold ms-6",disabled:p,children:p?"جاري التحميل...":"اضافة"})})]})]})}),e.jsx(V,{open:j,onClickButton1:()=>{c(!1)},onClickButton2:()=>{g("/cars/list"),c(!1)},text1:"إلغاء الإضافة",text2:"أنت على وشك إلغاء عملية إضافة سيارة دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟",textButton1:"إكمال الإضافة",textButton2:"إلغاء الإضافة"}),e.jsx(U,{open:_,text1:"تم إضافة سيارة بنجاح",text2:"تم تسجيل بيانات السيارة الجديدة، يمكنك أن تبدأ حجزها الآن.",textButton1:"العودة لقائمة السيارات",textButton2:"إضافة سيارة أخرى",onAddAnother:v,onReturnToList:()=>{g("/cars/list"),d(!1)}})]})}const ve=()=>e.jsxs("div",{className:"mt-6 mb-[102px]",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-6",children:[e.jsx(M,{text:"إضافة سيارة"}),e.jsx(O,{to:"/cars/list",children:e.jsx(b,{children:"عودة لقائمة السيارات"})})]}),e.jsx("div",{children:e.jsx(Y,{})})]});export{ve as default};
//# sourceMappingURL=addCar.page-F1cnLeC4.js.map
