{"version":3,"file":"addCar.page-F1cnLeC4.js","sources":["../../src/features/car/forms/schemas/addCar/form-schema.ts","../../src/features/car/forms/addCar/CarForm.tsx","../../src/features/car/pages/addCar.page.tsx"],"sourcesContent":["import { z } from 'zod';\r\n\r\nconst MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\r\nconst ALLOWED_FILE_TYPES = ['image/jpeg', 'image/png', 'image/jpg', 'image/gif', 'image/svg+xml'];\r\n\r\nexport const CarFormSchema = z.object({\r\n    arabicOtp: z\r\n        .string()\r\n        .length(3, 'Must be exactly 3 Arabic characters/digits')\r\n        .regex(/^[\\u0600-\\u06FF0-9]{3}$/, 'Invalid Arabic characters or numbers'),\r\n\r\n    numericOtp: z\r\n        .string()\r\n        .length(4, 'Must be exactly 4 digits')\r\n        .regex(/^\\d{4}$/, 'Must be numeric digits only'),\r\n\r\n    englishOtp: z\r\n        .string()\r\n        .length(3, 'Must be exactly 3 English letters')\r\n        .regex(/^[A-Z]{3}$/i, 'English letters only')\r\n        .transform((val) => val.toUpperCase()),\r\n\r\n    make_year: z.number({\r\n        required_error: 'Year of manufacture is required',\r\n    }),\r\n\r\n    vehicle_brand_id: z.number({ required_error: 'Brand is required' }),\r\n    vehicle_model_id: z.number({ required_error: 'Model is required' }),\r\n    car_type: z.string().min(2, 'Car type is required'),\r\n    transmission_type: z.enum(['auto', 'manual']),\r\n    tank: z.string().min(1, 'Tank capacity is required'),\r\n    vin: z.string().min(2, 'Chassis number is required'),\r\n    horse_power: z.string().min(1, 'Engine power is required'),\r\n    mileage: z.string().min(1, 'Number of kilometers is required'),\r\n\r\n    insurance_type: z.string().min(1, 'Insurance type is required'),\r\n    insurance_expiry_date: z\r\n        .date({\r\n            required_error: 'Insurance end date is required',\r\n        })\r\n        .min(new Date(), 'Insurance must be valid'),\r\n\r\n    license_expiry_date: z\r\n        .date({\r\n            required_error: 'License expiry date is required',\r\n        })\r\n        .min(new Date(), 'License expiry date must be valid'),\r\n    color: z.string().min(1, 'Color is required'),\r\n    next_maintainance_mile: z.string().min(0, 'Next maintenance mileage must be a positive integer'),\r\n    status: z.enum(['available', 'not available']),\r\n\r\n    images: z\r\n        .array(z.instanceof(File))\r\n        .min(1, 'At least one image is required')\r\n        .max(4, `Maximum 4 files allowed`)\r\n        .refine(\r\n            (files) => files.every((file) => file.size <= MAX_FILE_SIZE),\r\n            `Each Image must be less than ${MAX_FILE_SIZE}MB`,\r\n        )\r\n        .refine(\r\n            (files) => files.every((file) => ALLOWED_FILE_TYPES.includes(file.type)),\r\n            'Only .jpeg, .png, .jpg, .gif, and .svg formats are allowed',\r\n        ),\r\n\r\n    image: z\r\n        .instanceof(File, { message: 'Image is required' })\r\n        .refine((file) => file.size <= MAX_FILE_SIZE, `Image must be less than ${MAX_FILE_SIZE}MB`)\r\n        .refine(\r\n            (file) => ALLOWED_FILE_TYPES.includes(file.type),\r\n            'Only .jpeg, .png, .jpg, .gif, and .svg formats are allowed',\r\n        ),\r\n\r\n    license: z\r\n        .array(z.instanceof(File))\r\n        .min(1, 'At least one image is required')\r\n        .max(2, `Maximum 2 images allowed`)\r\n        .refine(\r\n            (files) => files.every((file) => file.size <= MAX_FILE_SIZE),\r\n            `Each file must be less than ${MAX_FILE_SIZE}MB`,\r\n        )\r\n        .refine(\r\n            (files) => files.every((file) => ALLOWED_FILE_TYPES.includes(file.type)),\r\n            'Only .jpeg, .png, .jpg, .gif, and .svg formats are allowed',\r\n        ),\r\n});\r\n\r\nexport type CarFormValues = z.infer<typeof CarFormSchema>;\r\n","import { Form } from '@/components/ui/form';\r\nimport { useForm } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { CarFormSchema, CarFormValues } from '../schemas/addCar/form-schema';\r\nimport InsuranceDetails from './InsuranceDetails';\r\nimport TechnicalSpecs from './TechnicalSpecs';\r\nimport { SubtleButton } from '@/components/buttons/SubtleButton';\r\nimport { PrimaryButton } from '@/components/buttons/PrimaryButton';\r\nimport VehicleInfo from './VehicleInfo';\r\nimport VehicleNumber from './VehicleNumber';\r\nimport DocumentsSection from './DocumentsSection';\r\nimport ExtraInfo from './ExtraInfo';\r\nimport { apiPost } from '@/lib/axios/axios-utils';\r\nimport { endpoints } from '@/lib/axios/axios-global';\r\nimport { format } from 'date-fns';\r\nimport { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport CarColor from './CarColor';\r\nimport CancelPopup from '@/components/Popups/CancelPopup';\r\nimport SuccessPopup from '@/components/Popups/SuccessPopup';\r\n\r\nexport default function CarForm() {\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [showSuccessPopup, setShowSuccessPopup] = useState(false);\r\n    const [showCancelPopup, setShowCancelPopup] = useState(false);\r\n    const navigate = useNavigate();\r\n\r\n    const form = useForm<CarFormValues>({\r\n        resolver: zodResolver(CarFormSchema),\r\n        defaultValues: {\r\n            arabicOtp: '',\r\n            numericOtp: '',\r\n            englishOtp: '',\r\n            make_year: undefined,\r\n            vehicle_model_id: undefined,\r\n            vehicle_brand_id: undefined,\r\n            car_type: '',\r\n            vin: '',\r\n            color: '',\r\n            tank: '',\r\n            horse_power: '',\r\n            mileage: '',\r\n            next_maintainance_mile: undefined,\r\n            transmission_type: 'auto',\r\n            insurance_type: '',\r\n            insurance_expiry_date: undefined,\r\n            license_expiry_date: undefined,\r\n            images: [],\r\n            license: [],\r\n        },\r\n    });\r\n\r\n    const handleAddAnother = () => {\r\n        setShowSuccessPopup(false);\r\n    };\r\n\r\n    const onSubmit = async (data: CarFormValues) => {\r\n        setLoading(true);\r\n        setError(null); // Clear previous errors\r\n\r\n        const formatedData = {\r\n            ...data,\r\n            insurance_expiry_date: format(data.insurance_expiry_date, 'yyyy-MM-dd'),\r\n            license_expiry_date: format(data.license_expiry_date, 'yyyy-MM-dd'),\r\n            plate_number: `${data.arabicOtp}-${data.numericOtp}-${data.englishOtp}`,\r\n            branch_id: 1,\r\n        };\r\n\r\n        try {\r\n            await apiPost({\r\n                endpoint: endpoints.cars.create,\r\n                body: formatedData,\r\n                config: { headers: { 'Content-Type': 'multipart/form-data' } },\r\n            });\r\n            setShowSuccessPopup(true);\r\n        } catch (error: any) {\r\n            if (error.response?.data?.errors) {\r\n                // Handle field-specific errors\r\n                Object.entries(error.response.data.errors).forEach(([field, messages]) => {\r\n                    if (field === 'plate_number') {\r\n                        form.setError('arabicOtp', {\r\n                            type: 'manual',\r\n                            message: 'The plate number has already been taken',\r\n                        });\r\n                        form.setError('englishOtp', {\r\n                            type: 'manual',\r\n                            message: 'The plate number has already been taken',\r\n                        });\r\n                        form.setError('numericOtp', {\r\n                            type: 'manual',\r\n                            message: 'The plate number has already been taken',\r\n                        });\r\n                    }\r\n                    form.setError(field as any, {\r\n                        type: 'manual',\r\n                        message: (messages as string[]).join(', '),\r\n                    });\r\n                });\r\n            } else {\r\n                // Handle generic error\r\n                let errorMessage = 'حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.';\r\n                if (error.response) {\r\n                    errorMessage = error.response.data.msg || errorMessage;\r\n                } else if (error.request) {\r\n                    errorMessage = 'تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت.';\r\n                }\r\n                setError(errorMessage);\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Form {...form}>\r\n                <form onSubmit={form.handleSubmit(onSubmit)}>\r\n                    <VehicleNumber />\r\n                    <VehicleInfo />\r\n                    <TechnicalSpecs />\r\n                    <CarColor />\r\n                    <InsuranceDetails />\r\n                    <ExtraInfo />\r\n                    <DocumentsSection />\r\n                    {error && (\r\n                        <div className=\"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span>{error}</span>\r\n                                <button onClick={() => setError(null)} className=\"text-red-700 hover:text-red-900\">\r\n                                    ×\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"flex flex-row justify-between items-center\">\r\n                        <SubtleButton\r\n                            onClick={() => setShowCancelPopup(true)}\r\n                            type=\"button\"\r\n                            className=\"xl:px-[61.5px] xl:py-4 xl:font-bold\"\r\n                        >\r\n                            الغاء\r\n                        </SubtleButton>\r\n                        <div>\r\n                            <PrimaryButton className=\"xl:px-[154px] xl:py-[18px] xl:font-bold ms-6\" disabled={loading}>\r\n                                {loading ? 'جاري التحميل...' : 'اضافة'}\r\n                            </PrimaryButton>\r\n                        </div>\r\n                    </div>\r\n                </form>\r\n            </Form>\r\n            <CancelPopup\r\n                open={showCancelPopup}\r\n                onClickButton1={() => {\r\n                    setShowCancelPopup(false);\r\n                }}\r\n                onClickButton2={() => {\r\n                    navigate('/cars/list');\r\n                    setShowCancelPopup(false);\r\n                }}\r\n                text1=\"إلغاء الإضافة\"\r\n                text2=\"أنت على وشك إلغاء عملية إضافة سيارة دون إكمال البيانات المطلوبة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟\"\r\n                textButton1=\"إكمال الإضافة\"\r\n                textButton2=\"إلغاء الإضافة\"\r\n            />\r\n            <SuccessPopup\r\n                open={showSuccessPopup}\r\n                text1=\"تم إضافة سيارة بنجاح\"\r\n                text2=\"تم تسجيل بيانات السيارة الجديدة، يمكنك أن تبدأ حجزها الآن.\"\r\n                textButton1=\"العودة لقائمة السيارات\"\r\n                textButton2=\"إضافة سيارة أخرى\"\r\n                onAddAnother={handleAddAnother}\r\n                onReturnToList={() => {\r\n                    navigate('/cars/list');\r\n                    setShowSuccessPopup(false);\r\n                }}\r\n            />\r\n        </>\r\n    );\r\n}\r\n","import { SubtleButton } from '@/components/buttons/SubtleButton';\r\nimport UnderlineHeading from '@/components/heading/UnderlineHeading';\r\nimport { Link } from 'react-router-dom';\r\nimport CarForm from '../forms/addCar/CarForm';\r\n\r\nconst AddCarPage = () => {\r\n    return (\r\n        <div className=\"mt-6 mb-[102px]\">\r\n            <div className=\"flex flex-row justify-between mb-6\">\r\n                <UnderlineHeading text=\"إضافة سيارة\" />\r\n                <Link to=\"/cars/list\">\r\n                    <SubtleButton>عودة لقائمة السيارات</SubtleButton>\r\n                </Link>\r\n            </div>\r\n            <div>\r\n                <CarForm />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AddCarPage;\r\n"],"names":["MAX_FILE_SIZE","ALLOWED_FILE_TYPES","CarFormSchema","z","val","files","file","CarForm","error","setError","useState","loading","setLoading","showSuccessPopup","setShowSuccessPopup","showCancelPopup","setShowCancelPopup","navigate","useNavigate","form","useForm","zodResolver","handleAddAnother","onSubmit","data","formatedData","format","apiPost","endpoints","field","messages","errorMessage","jsxs","Fragment","jsx","Form","VehicleNumber","VehicleInfo","TechnicalSpecs","CarColor","InsuranceDetails","ExtraInfo","DocumentsSection","SubtleButton","PrimaryButton","CancelPopup","SuccessPopup","AddCarPage","UnderlineHeading","Link"],"mappings":"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"}