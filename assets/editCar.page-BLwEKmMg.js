import{r as o,d as S,j as t,e as _,t as w,f as q,g as N,B as I,L as M}from"./index-CG21Kl6L.js";import{S as C}from"./SubtleButton-CIWvV8XM.js";import{U as F}from"./UnderlineHeading-6dFpHrZu.js";import{T as k}from"./TrashIcon-B-yPmS4K.js";import{a as D,b as O}from"./axios-utils-DWLLXNPU.js";import{z as s,u as B,t as P,F as L}from"./index-CVKxZN6H.js";import{P as $}from"./PrimaryButton-CqSNXaEZ.js";import{V as A,a as T,T as z,C as V,I as U,E as Y,D as Z}from"./CarColor-Bw5KmO57.js";import{C as G}from"./CancelPopup-DkpTHoXx.js";import{S as H}from"./SuccessIcon-kUOFEumJ.js";import{f as v}from"./format-D6Kkl3rb.js";import{D as R}from"./DeletePopup-Cp9aF88T.js";import"./index-DKOmws7K.js";import"./select-cvP0Sup0.js";import"./Combination-CF6sjIQ5.js";import"./index-CVxAI6rk.js";import"./popover-GWOz0UH_.js";import"./chevron-right-ofNdHrp6.js";import"./chevron-left-Dd3efAkK.js";import"./index-BuoIejD9.js";import"./CalendarIcon-vdySZVWB.js";import"./radio-group-BJw_bK89.js";import"./index-Iw2dua5F.js";import"./configs.data-DRMm0Ppl.js";import"./TextInputForm-ML6m37PA.js";import"./ImgInputForm-CvU2WXhj.js";import"./index-BrlmtnpO.js";import"./index-CoxrFmRa.js";import"./SecondaryButton-C8PAsQMM.js";import"./removeDuplicated-BgoSiW5F.js";import"./dialog-BNTutzAA.js";const m=2*1024*1024,y=["image/jpeg","image/png","image/jpg","image/gif","image/svg+xml"],W=s.object({arabicOtp:s.string().length(3,"Must be exactly 3 Arabic characters/digits").regex(/^[\u0600-\u06FF0-9]{3}$/,"Invalid Arabic characters or numbers"),numericOtp:s.string().length(4,"Must be exactly 4 digits").regex(/^\d{4}$/,"Must be numeric digits only"),englishOtp:s.string().length(3,"Must be exactly 3 English letters").regex(/^[A-Z]{3}$/i,"English letters only").transform(e=>e.toUpperCase()),make_year:s.number({required_error:"Year of manufacture is required"}),vehicle_brand_id:s.number({required_error:"Brand is required"}),vehicle_model_id:s.number({required_error:"Model is required"}),car_type:s.string().min(2,"Car type is required"),transmission_type:s.enum(["auto","manual"]),tank:s.string().min(1,"Tank capacity is required"),vin:s.string().min(2,"Chassis number is required"),horse_power:s.string().min(1,"Engine power is required"),mileage:s.string().min(1,"Number of kilometers is required"),insurance_type:s.string().min(1,"Insurance type is required"),insurance_expiry_date:s.date({required_error:"Insurance end date is required"}).min(new Date,"Insurance must be valid"),license_expiry_date:s.date({required_error:"License expiry date is required"}).min(new Date,"License expiry date must be valid"),color:s.string().min(1,"Color is required"),next_maintainance_mile:s.string().min(0,"Next maintenance mileage must be a positive integer"),status:s.enum(["available","not available"]),images:s.array(s.union([s.instanceof(File),s.string()])).min(1,"At least one image is required").max(4,"Maximum 4 files allowed").refine(e=>e.every(i=>(typeof i=="string"||i.size<=m)&&(typeof i=="string"||y.includes(i.type))),`Each Image must be less than ${m}MB and in allowed formats`).optional(),image:s.union([s.instanceof(File,{message:"Image is required"}),s.string()]).refine(e=>(typeof e=="string"||e.size<=m)&&(typeof e=="string"||y.includes(e.type)),`Image must be less than ${m}MB and in allowed formats`).optional(),license:s.array(s.union([s.instanceof(File),s.string()])).min(1,"At least one image is required").max(2,"Maximum 2 images allowed").refine(e=>e.every(i=>(typeof i=="string"||i.size<=m)&&(typeof i=="string"||y.includes(i.type))),`Each file must be less than ${m}MB and in allowed formats`).optional()});function X({car:e}){const[i,r]=o.useState(null),[u,a]=o.useState(!1),[f,p]=o.useState(!1),c=S(),l=B({resolver:P(W),defaultValues:{arabicOtp:(e==null?void 0:e.arabicOtp)||"",numericOtp:(e==null?void 0:e.numericOtp)||"",englishOtp:(e==null?void 0:e.englishOtp)||"",make_year:(e==null?void 0:e.make_year)||void 0,vehicle_model_id:(e==null?void 0:e.vehicle_brand_id)||void 0,vehicle_brand_id:(e==null?void 0:e.vehicle_brand_id)||void 0,car_type:(e==null?void 0:e.car_type)||"",vin:(e==null?void 0:e.vin)||"",color:(e==null?void 0:e.color)||"",status:(e==null?void 0:e.status)||"available",tank:(e==null?void 0:e.tank.toString())||void 0,horse_power:(e==null?void 0:e.horse_power.toString())||void 0,mileage:(e==null?void 0:e.mileage.toString())||void 0,next_maintainance_mile:(e==null?void 0:e.next_maintainance_mile.toString())||void 0,transmission_type:(e==null?void 0:e.transmission_type)||"auto",insurance_type:(e==null?void 0:e.insurance_type)||"comprehensive",insurance_expiry_date:e!=null&&e.insurance_expiry_date?new Date(e.insurance_expiry_date):void 0,license_expiry_date:e!=null&&e.license_expiry_date?new Date(e==null?void 0:e.license_expiry_date):void 0,images:(e==null?void 0:e.media.images)||[],image:(e==null?void 0:e.media.image)||"",license:(e==null?void 0:e.media.license)||[]}}),h=async n=>{var x,j;a(!0),r(null);const b={...n,insurance_expiry_date:n.insurance_expiry_date?v(n.insurance_expiry_date,"yyyy-MM-dd"):"",license_expiry_date:n.license_expiry_date?v(n.license_expiry_date,"yyyy-MM-dd"):"",branch_id:1,plate_number:`${n.arabicOtp}-${n.numericOtp}-${n.englishOtp}`};try{await D({endpoint:_.cars.update+e.id,body:b,config:{headers:{"Content-Type":"multipart/form-data"}}}),w.success("تم تحديث معلومات السيارة بنجاح",{duration:3e3,className:"font-cairo",icon:t.jsx(H,{width:"25",height:"25",className:"text-green-success-600"})}),c("/cars/list")}catch(g){if((j=(x=g.response)==null?void 0:x.data)!=null&&j.errors)Object.entries(g.response.data.errors).forEach(([d,E])=>{l.setError(d,{type:"manual",message:E.join(", ")})});else{let d="حدث خطأ أثناء إرسال البيانات. يرجى المحاولة مرة أخرى.";g.response?d=g.response.data.msg||d:g.request&&(d="تعذر الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت."),r(d)}}finally{a(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx(L,{...l,children:t.jsxs("form",{onSubmit:l.handleSubmit(h),children:[t.jsx(A,{}),t.jsx(T,{car:e}),t.jsx(z,{}),t.jsx(V,{}),t.jsx(U,{}),t.jsx(Y,{}),t.jsx(Z,{media:e.media}),i&&t.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{children:i}),t.jsx("button",{onClick:()=>r(null),className:"text-red-700 hover:text-red-900",children:"×"})]})}),t.jsxs("div",{className:"flex flex-row justify-between items-center",children:[t.jsx(C,{onClick:()=>p(!0),type:"button",className:"xl:px-[61.5px] xl:py-4 xl:font-bold",children:"الغاء"}),t.jsx("div",{children:t.jsx($,{className:"xl:px-[154px] xl:py-[18px] xl:font-bold ms-6",disabled:u,children:u?"جاري التحميل...":"تعديل"})})]})]})}),t.jsx(G,{open:f,onClickButton1:()=>{p(!1)},onClickButton2:()=>{c("/cars/list"),p(!1)},text1:"إلغاء التعديل",text2:"أنت على وشك إلغاء عملية تعديل سيارة. سيتم تجاهل جميع البيانات المدخلة، هل أنت متأكد؟",textButton1:"إكمال التعديل",textButton2:"إلغاء التعديل"})]})}const Ne=()=>{const e=S(),i=q(),{id:r}=i,[u,a]=o.useState(!1),[f,p]=o.useState(null),[c,l]=o.useState(!0),[h,n]=o.useState(null);return o.useEffect(()=>{r?(async()=>{try{const x=await O({endpoint:_.cars.show+r});p(x.data.data)}catch{n("Failed to load car details")}finally{l(!1)}})():(n("Invalid car ID"),l(!1))},[r]),c?t.jsx(N,{}):h?t.jsx("div",{className:"mt-6 mb-[102px] text-center py-20",children:t.jsx("h2",{className:"text-xl text-red-500",children:h})}):f?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mt-6 mb-[102px]",children:[t.jsxs("div",{className:"flex flex-row justify-between mb-6",children:[t.jsx(F,{text:"تعديل بيانات السيارة"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(I,{className:"bg-red-50 hover:bg-red-100 cursor-pointer rounded-lg border border-red-50 p-2",onClick:()=>a(!0),children:t.jsx(k,{className:"text-red-error-600"})}),t.jsx(M,{to:"/cars/list",children:t.jsx(C,{children:"عودة لقائمة السيارات"})})]})]}),t.jsx("div",{children:t.jsx(X,{car:f})})]}),u&&t.jsx(R,{open:u,endpoint:_.cars.delete+r,text:"هل أنت متاكد أنك تريد حذف هذه السيارة",handleCancel:()=>a(!1),handleSuccess:()=>{w.error("تم حذف السيارة بنجاح"),e("/cars"),a(!1)}})]}):t.jsx("div",{className:"mt-6 mb-[102px] text-center py-20",children:t.jsx("h2",{className:"text-xl",children:"Car not found"})})};export{Ne as default};
//# sourceMappingURL=editCar.page-BLwEKmMg.js.map
